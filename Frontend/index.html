<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PicStone¬Æ mobile</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="style.css?v=20251119010500">
</head>
<body>
    <!-- Banner de Aviso de Expira√ß√£o -->
    <div id="expirationBanner" class="expiration-banner hidden">
        <div class="expiration-content">
            <span class="expiration-icon">‚ö†Ô∏è</span>
            <span id="expirationMessage" class="expiration-message"></span>
            <button onclick="fecharBannerExpiracao()" class="expiration-close">√ó</button>
        </div>
    </div>

    <!-- Tela de Login/Cadastro -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <div class="logo-container">
                <img src="images/logo.png" alt="PicStone Mobile" class="logo-image">
            </div>

            <!-- Abas de Navega√ß√£o -->
            <div class="auth-tabs">
                <button id="loginTab" class="auth-tab active">Entrar</button>
                <button id="registerTab" class="auth-tab">Criar Conta</button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="form-card auth-form active">
                <div class="form-group">
                    <label for="username">Email</label>
                    <input type="email" id="username" name="username" required autocomplete="email" placeholder="rogerio@isidorio.com.br">
                </div>

                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <button type="submit" class="btn btn-primary btn-full">Entrar</button>

                <div id="loginError" class="error-message hidden"></div>
            </form>

            <!-- Formul√°rio de Cadastro -->
            <form id="registerForm" class="form-card auth-form">
                <div class="form-group">
                    <label for="registerNomeCompleto">Nome Completo *</label>
                    <input type="text" id="registerNomeCompleto" name="nomeCompleto" required minlength="3" placeholder="Ex: Jo√£o Silva">
                </div>

                <div class="form-group">
                    <label for="registerEmail">Email *</label>
                    <input type="email" id="registerEmail" name="email" required placeholder="seu.email@exemplo.com">
                </div>

                <div class="form-group">
                    <label for="registerSenha">Senha * (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="registerSenha" name="senha" required minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div class="form-group">
                    <label for="registerConfirmarSenha">Confirmar Senha *</label>
                    <input type="password" id="registerConfirmarSenha" name="confirmarSenha" required minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <button type="submit" class="btn btn-primary btn-full">Criar Conta</button>

                <div id="registerMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de Verifica√ß√£o de Email -->
    <div id="emailVerificationScreen" class="screen">
        <div class="container">
            <div class="verification-card">
                <div id="verificationIcon" class="verification-icon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <h1 id="verificationTitle">Verificando...</h1>
                <p id="verificationMessage" class="verification-message">Aguarde enquanto verificamos seu email.</p>
                <div id="verificationActions" class="verification-actions hidden">
                    <button id="goToLoginFromVerification" class="btn btn-primary">Ir para Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela Principal - Menu Inicial -->
    <div id="mainScreen" class="screen">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <h1>PicStone Mobile</h1>
                </div>
                <div class="header-right">
                    <div class="user-menu">
                        <button id="userMenuBtn" class="user-menu-btn">
                            <div class="user-avatar">
                                <span id="userInitials"></span>
                            </div>
                            <span id="userDisplay" class="user-name"></span>
                            <svg class="chevron-down" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        <div id="userMenuDropdown" class="user-menu-dropdown hidden">
                            <div class="dropdown-header">
                                <div class="dropdown-user-info">
                                    <span class="dropdown-username" id="dropdownUsername"></span>
                                    <span class="dropdown-email" id="dropdownEmail"></span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button id="changePasswordBtn" class="dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                Trocar Senha
                            </button>
                            <button id="manageUsersBtn" class="dropdown-item hidden">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Gerenciar Usu√°rios
                            </button>
                            <button id="pendingUsersBtn" class="dropdown-item hidden">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                Solicita√ß√µes Pendentes
                            </button>
                            <button id="historyBtn" class="dropdown-item hidden">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Hist√≥rico de Uso
                            </button>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-version">
                                <span class="version-label">Vers√£o</span>
                                <span id="appVersion" class="version-number">Carregando...</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button id="logoutBtn" class="dropdown-item danger">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                Sair
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards de Op√ß√µes Principais -->
            <div class="main-options">
                <div class="option-card" id="ambientesCard">
                    <div class="option-icon">
                        <img src="icon-ambientes.png" alt="Ambientes">
                    </div>
                    <h2>Ambientes</h2>
                </div>

                <div class="option-card" id="bookmatchCard">
                    <div class="option-icon-image">
                        <img src="images/Thumb_bookmatch.jpg" alt="BookMatch">
                    </div>
                    <h2>BookMatch</h2>
                </div>

                <div class="option-card" id="integracaoCard">
                    <div class="option-icon">üîó</div>
                    <h2>Integra√ß√£o</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Integra√ß√£o -->
    <div id="integracaoScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainFromIntegracaoBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Integra√ß√£o</h1>
            </div>

            <!-- Preview da Foto -->
            <div id="photoPreviewIntegracao" class="photo-preview hidden">
                <div class="image-container">
                    <img id="previewImageIntegracao" src="" alt="Preview">
                    <canvas id="cropOverlayIntegracao" class="crop-overlay hidden"></canvas>
                    <div id="cropIndicatorIntegracao" class="crop-indicator hidden">
                        <p>üëÜ Arraste para selecionar a √°rea</p>
                    </div>
                </div>
                <button id="clearPhotoBtnIntegracao" class="btn-clear">‚úï</button>
                <button id="resetImageBtnIntegracao" class="btn-reset-icon hidden" title="Voltar √† Original">‚Ü©Ô∏è</button>
                <button id="adjustImageBtnIntegracao" class="btn-crop-icon" title="Ajustar Imagem">‚úÇÔ∏è</button>
            </div>

            <!-- Bot√£o de Captura -->
            <div class="capture-section">
                <input type="file" id="fileInputIntegracao" accept="image/*" hidden>
                <button id="captureBtnIntegracao" class="btn btn-capture">
                    <span class="camera-icon">üì∑</span>
                    Escolher/Tirar Foto
                </button>
            </div>

            <!-- Formul√°rio de Dados -->
            <form id="uploadForm" class="form-card">
                <div class="form-group">
                    <label for="material">Material *</label>
                    <select id="material" name="material" required>
                        <option value="">Carregando materiais...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bloco">N√∫mero do Bloco *</label>
                    <input type="text" id="bloco" name="bloco" required placeholder="Ex: 12345 ou BL123" style="text-transform: uppercase;">
                </div>

                <div class="form-group">
                    <label for="chapa">N√∫mero da Chapa *</label>
                    <input type="text" id="chapa" name="chapa" required placeholder="Ex: 001">
                </div>

                <div class="form-group">
                    <label for="espessura">Espessura (cm)</label>
                    <select id="espessura" name="espessura">
                        <option value="">Selecione...</option>
                        <option value="2">2 cm</option>
                        <option value="3">3 cm</option>
                    </select>
                </div>

                <button type="submit" id="submitBtn" class="btn btn-primary" disabled>
                    Enviar Foto
                </button>

                <div id="uploadProgress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p class="progress-text">Enviando...</p>
                </div>

                <div id="uploadMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de BookMatch -->
    <div id="bookmatchScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainFromBookmatchBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>BookMatch</h1>
            </div>

            <!-- Preview da Foto -->
            <div id="photoPreviewBookmatch" class="photo-preview hidden">
                <div class="image-container">
                    <img id="previewImageBookmatch" src="" alt="Preview">
                    <canvas id="cropOverlayBookmatch" class="crop-overlay hidden"></canvas>
                    <div id="cropIndicatorBookmatch" class="crop-indicator hidden">
                        ‚úÇÔ∏è Selecione a √°rea para recortar
                    </div>
                </div>
                <button id="clearPhotoBtnBookmatch" class="btn-clear">‚úï</button>
                <button id="resetImageBtnBookmatch" class="btn-reset-icon hidden" title="Voltar √† Original">‚Ü©Ô∏è</button>
                <button id="adjustImageBtnBookmatch" class="btn-crop-icon" title="Ajustar Imagem">‚úÇÔ∏è</button>
            </div>

            <!-- Bot√£o de Captura -->
            <div id="captureSectionBookmatch" class="capture-section">
                <input type="file" id="fileInputBookmatch" accept="image/*" hidden>
                <button id="captureBtnBookmatch" class="btn btn-capture">
                    <span class="camera-icon">üì∑</span>
                    Escolher/Tirar Foto
                </button>
            </div>

            <!-- Op√ß√µes do BookMatch -->
            <div id="bookmatchOptions" class="bookmatch-options hidden">
                <h3>Op√ß√µes de Gera√ß√£o:</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="addSeparatorLines">
                        Adicionar linhas separadoras
                    </label>
                </div>
                <button id="generateBookmatchBtn" class="btn btn-primary">Gerar BookMatch</button>
            </div>

            <!-- Resultados do BookMatch -->
            <div id="bookmatchResults" class="bookmatch-results hidden">
                <h3>Resultados:</h3>
                <div class="result-grid">
                    <div class="result-item">
                        <h4>Mosaico 3x3</h4>
                        <img id="mosaicImage" src="" alt="Mosaico">
                        <div class="result-actions">
                            <button onclick="downloadBookmatchImage('mosaic')" class="btn-action">‚¨á Baixar</button>
                            <button onclick="shareBookmatchImage('mosaic')" class="btn-action">üì§ Compartilhar</button>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>Quadrante 1</h4>
                        <img id="quadrant1Image" src="" alt="Quadrante 1">
                        <div class="result-actions">
                            <button onclick="downloadBookmatchImage('quad1')" class="btn-action">‚¨á Baixar</button>
                            <button onclick="shareBookmatchImage('quad1')" class="btn-action">üì§ Compartilhar</button>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>Quadrante 2</h4>
                        <img id="quadrant2Image" src="" alt="Quadrante 2">
                        <div class="result-actions">
                            <button onclick="downloadBookmatchImage('quad2')" class="btn-action">‚¨á Baixar</button>
                            <button onclick="shareBookmatchImage('quad2')" class="btn-action">üì§ Compartilhar</button>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>Quadrante 3</h4>
                        <img id="quadrant3Image" src="" alt="Quadrante 3">
                        <div class="result-actions">
                            <button onclick="downloadBookmatchImage('quad3')" class="btn-action">‚¨á Baixar</button>
                            <button onclick="shareBookmatchImage('quad3')" class="btn-action">üì§ Compartilhar</button>
                        </div>
                    </div>
                    <div class="result-item">
                        <h4>Quadrante 4</h4>
                        <img id="quadrant4Image" src="" alt="Quadrante 4">
                        <div class="result-actions">
                            <button onclick="downloadBookmatchImage('quad4')" class="btn-action">‚¨á Baixar</button>
                            <button onclick="shareBookmatchImage('quad4')" class="btn-action">üì§ Compartilhar</button>
                        </div>
                    </div>
                </div>
                <button id="newBookmatchBtn" class="btn btn-secondary">Novo BookMatch</button>
            </div>
        </div>
    </div>

    <!-- Tela de Ambientes - Sele√ß√£o de Imagem -->
    <div id="ambientesScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainFromAmbientesBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Ambientes</h1>
            </div>

            <!-- Preview da Foto -->
            <div id="photoPreviewAmbientes" class="photo-preview hidden">
                <div class="image-container">
                    <img id="previewImageAmbientes" src="" alt="Preview">
                    <canvas id="cropOverlayAmbientes" class="crop-overlay hidden"></canvas>
                    <div id="cropIndicatorAmbientes" class="crop-indicator hidden">
                        ‚úÇÔ∏è Selecione a √°rea para recortar
                    </div>
                </div>
                <button id="clearPhotoBtnAmbientes" class="btn-clear">‚úï</button>
                <button id="resetImageBtnAmbientes" class="btn-reset-icon hidden" title="Voltar √† Original">‚Ü©Ô∏è</button>
                <button id="adjustImageBtnAmbientes" class="btn-crop-icon" title="Ajustar Imagem">‚úÇÔ∏è</button>
            </div>

            <!-- Bot√£o de Captura -->
            <div id="captureSectionAmbientes" class="capture-section">
                <input type="file" id="fileInputAmbientes" accept="image/*" hidden>
                <button id="captureBtnAmbientes" class="btn btn-capture">
                    <span class="camera-icon">üì∑</span>
                    Escolher/Tirar Foto
                </button>
            </div>

            <!-- Bot√µes de Simula√ß√£o (aparecem ap√≥s escolher imagem) -->
            <div id="ambienteOptions" class="ambiente-options hidden">
                <h3>Escolha o tipo de ambiente:</h3>
                <button id="ambienteBtn" class="btn btn-ambiente">Frames</button>
                <button id="countertopsBtn" class="btn btn-countertops">Countertops</button>
                <button id="bathroomsBtn" class="btn btn-bathrooms">Bathrooms</button>
                <button id="livingRoomsBtn" class="btn btn-livingrooms">Living Rooms</button>
                <button id="stairsBtn" class="btn btn-stairs">Stairs</button>
            </div>
        </div>
    </div>

    <!-- Tela de Crop -->
    <div id="cropScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelCropBtn" class="btn-icon">‚Üê Cancelar</button>
                <h1>Ajustar Imagem</h1>
            </div>

            <div class="crop-instructions">
                <p>Arraste para selecionar a √°rea de corte</p>
                <small>O corte ser√° aplicado automaticamente ao soltar</small>
            </div>

            <div class="crop-container">
                <canvas id="cropCanvas"></canvas>
            </div>

            <div id="cropInfo" class="crop-info hidden">
                <div class="crop-info-item">
                    <span class="crop-info-label">√Årea:</span>
                    <span id="cropInfoArea">-</span>
                </div>
                <div class="crop-info-item">
                    <span class="crop-info-label">Megapixels:</span>
                    <span id="cropInfoMP">-</span>
                </div>
                <div class="crop-info-item">
                    <span class="crop-info-label">Tamanho estimado:</span>
                    <span id="cropInfoSize">-</span>
                </div>
            </div>

            <div class="crop-actions">
                <button id="resetCropBtn" class="btn btn-secondary">Resetar Sele√ß√£o</button>
            </div>
        </div>
    </div>

    <!-- Tela de Configura√ß√£o de Ambiente -->
    <div id="ambienteConfigScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelAmbienteBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Simular Cavalete</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="form-group">
                    <label>Selecione o Fundo</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="fundoCavalete" value="claro" checked>
                            <span>‚òÄÔ∏è Claro</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fundoCavalete" value="escuro">
                            <span>üåô Escuro</span>
                        </label>
                    </div>
                </div>

                <button id="continuarCropAmbienteBtn" class="btn btn-primary">Gerar Frame</button>
            </div>
        </div>
    </div>

    <!-- Tela de Configura√ß√£o do Nicho -->
    <div id="nichoConfigScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelNichoBtn" class="btn-icon">‚Üê Cancelar</button>
                <h1>Configurar Nicho</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="info-box">
                    <p><strong>üöø Ambiente de Nicho de Banheiro</strong></p>
                    <p>Crie visualiza√ß√µes realistas de nichos com sua pedra natural.</p>
                    <p>Ser√£o geradas 2 vers√µes (normal e rotacionada 180¬∞).</p>
                </div>

                <div class="config-section">
                    <h3>Fundo do Ambiente</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="fundoNicho" value="claro" checked>
                            <span>‚òÄÔ∏è Claro (Branco)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fundoNicho" value="escuro">
                            <span>üåô Escuro (Cinza)</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Objetos Decorativos</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="incluirShampoo" name="incluirShampoo">
                            <span>üß¥ Incluir Frasco de Shampoo</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="incluirSabonete" name="incluirSabonete">
                            <span>üßº Incluir Sabonete</span>
                        </label>
                    </div>
                </div>

                <button id="continuarCropNichoBtn" class="btn btn-primary">Continuar para Crop</button>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Bancada -->
    <div id="countertopSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelCountertopSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha a Bancada</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="bancada1">
                            <div class="countertop-preview" data-type="bancada1">
                                <img src="/images/thumb-bancada1.webp" alt="Preview Bancada #1" width="256" height="256">
                            </div>
                            <h4>Bancada #1</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada2">
                            <div class="countertop-preview" data-type="bancada2">
                                <img src="/images/thumb-bancada2.webp" alt="Preview Bancada #2" width="256" height="256">
                            </div>
                            <h4>Bancada #2</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada3">
                            <div class="countertop-preview" data-type="bancada3">
                                <img src="/images/thumb-bancada3.webp" alt="Preview Bancada #3" width="256" height="256">
                            </div>
                            <h4>Bancada #3</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada4">
                            <div class="countertop-preview" data-type="bancada4">
                                <img src="/images/thumb-bancada4.webp" alt="Preview Bancada #4" width="256" height="256">
                            </div>
                            <h4>Bancada #4</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada5">
                            <div class="countertop-preview" data-type="bancada5">
                                <img src="/images/thumb-bancada5.webp" alt="Preview Bancada #5" width="256" height="256">
                            </div>
                            <h4>Bancada #5</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada6">
                            <div class="countertop-preview" data-type="bancada6">
                                <img src="/images/thumb-bancada6.webp" alt="Preview Bancada #6" width="256" height="256">
                            </div>
                            <h4>Bancada #6</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada7">
                            <div class="countertop-preview" data-type="bancada7">
                                <img src="/images/thumb-bancada7.webp" alt="Preview Bancada #7" width="256" height="256">
                            </div>
                            <h4>Bancada #7</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada8">
                            <div class="countertop-preview" data-type="bancada8">
                                <img src="/images/thumb-bancada8.webp" alt="Preview Bancada #8" width="256" height="256">
                            </div>
                            <h4>Bancada #8</h4>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Op√ß√µes Globais</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="flipCountertop" name="flipCountertop">
                            <span>‚ÜîÔ∏è Inverter Horizontalmente (Flip)</span>
                        </label>
                    </div>
                    <small style="color: #6b7280; display: block; margin-top: 8px;">
                        Ser√£o geradas 2 vers√µes (normal e rotacionada 180¬∞)
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Banheiro -->
    <div id="bathroomSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelBathroomSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha o Banheiro</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="banho1">
                            <div class="countertop-preview" data-type="banho1">
                                <img src="/images/thumb-banho1.webp" alt="Preview Banheiro #1">
                            </div>
                            <h4>Banheiro #1</h4>
                        </div>
                        <div class="countertop-card" data-type="banho2">
                            <div class="countertop-preview" data-type="banho2">
                                <img src="/images/thumb-banho2.webp" alt="Preview Banheiro #2">
                            </div>
                            <h4>Banheiro #2</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Living Room -->
    <div id="livingRoomSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelLivingRoomSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha a Sala</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="sala1">
                            <div class="countertop-preview" data-type="sala1">
                                <img src="/images/thumb-sala1.webp" alt="Preview Living Room #1">
                            </div>
                            <h4>Living Room #1</h4>
                        </div>
                        <div class="countertop-card" data-type="sala2">
                            <div class="countertop-preview" data-type="sala2">
                                <img src="/images/thumb-sala2.webp" alt="Preview Living Room #2">
                            </div>
                            <h4>Living Room #2</h4>
                            <p style="color: #6b7280; font-size: 0.875rem; margin-top: 4px;">BookMatch 2x2 + Skew</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Living Room TESTE (c√≥pia exata do Bathroom) -->
    <div id="livingRoomTestSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelLivingRoomTestSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha a Sala (TESTE)</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="testelivingroom1">
                            <div class="countertop-preview" data-type="testelivingroom1">
                                <img src="/images/thumb-sala1.webp" alt="Preview Living Room TESTE #1">
                            </div>
                            <h4>Living Room TESTE #1</h4>
                        </div>
                        <div class="countertop-card" data-type="testelivingroom2">
                            <div class="countertop-preview" data-type="testelivingroom2">
                                <img src="/images/thumb-livingroom2.webp" alt="Preview Living Room TESTE #2">
                            </div>
                            <h4>Living Room TESTE #2</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Stairs -->
    <div id="stairsSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelStairsSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha a Escada</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="stairs1">
                            <div class="countertop-preview" data-type="stairs1">
                                <img src="images/thumb-escada1.webp?v=20251118234600" alt="Preview Escada #1">
                            </div>
                            <h4>Escada #1</h4>
                        </div>

                        <div class="countertop-card" data-type="stairs2">
                            <div class="countertop-preview" data-type="stairs2">
                                <img src="images/thumb-escada2.webp?v=20251118234600" alt="Preview Escada #2">
                            </div>
                            <h4>Escada #2</h4>
                        </div>

                        <!-- TODO: Implementar Escada #3
                        <div class="countertop-card" data-type="stairs3">
                            <div class="countertop-preview" data-type="stairs3">
                                <img src="images/thumb-escada3.webp?v=20251118234600" alt="Preview Escada #3">
                            </div>
                            <h4>Escada #3</h4>
                        </div>
                        -->

                        <!-- TODO: Implementar Escada #4
                        <div class="countertop-card" data-type="stairs4">
                            <div class="countertop-preview" data-type="stairs4">
                                <img src="images/thumb-escada4.webp?v=20251118234600" alt="Preview Escada #4">
                            </div>
                            <h4>Escada #4</h4>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Resultado do Ambiente -->
    <div id="ambienteResultScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Ambientes Gerados</h1>
            </div>

            <div id="ambientesGallery" class="ambientes-gallery">
                <!-- Os ambientes ser√£o inseridos aqui dinamicamente -->
            </div>

            <div class="ambiente-actions">
                <button id="downloadAllAmbientesBtn" class="btn btn-primary">‚¨áÔ∏è Baixar Todos</button>
                <button id="newAmbienteBtn" class="btn btn-secondary">üîÑ Gerar Novos</button>
            </div>

            <div id="ambienteMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- Tela de Hist√≥rico -->
    <!-- Tela de Hist√≥rico de Uso (Admin) -->
    <div id="historyScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromHistoryBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Hist√≥rico de Uso</h1>
            </div>

            <!-- Abas para alternar entre visualiza√ß√µes -->
            <div class="history-tabs">
                <button id="allUsersTab" class="history-tab active">Todos os Usu√°rios</button>
                <button id="myHistoryTab" class="history-tab">Meu Hist√≥rico</button>
            </div>

            <!-- Lista de Todos os Usu√°rios (Admin) -->
            <div id="allUsersView" class="history-view active">
                <!-- Campo de Busca -->
                <div class="search-box">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="searchUsersInput" class="search-input" placeholder="Buscar por nome ou email...">
                </div>

                <!-- Bot√µes de Visualiza√ß√£o -->
                <div class="view-toggle-container">
                    <button id="cardViewBtn" class="view-toggle-btn active">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                        </svg>
                        Cards
                    </button>
                    <button id="tableViewBtn" class="view-toggle-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                        Tabela
                    </button>
                </div>

                <div id="usersStatsList" class="users-stats-list">
                    <p class="loading">Carregando estat√≠sticas...</p>
                </div>

                <!-- Visualiza√ß√£o em Tabela -->
                <div id="usersStatsTable" class="users-stats-table">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Total Logins</th>
                                    <th>Ambientes</th>
                                    <th>Primeiro Acesso</th>
                                    <th>√öltimo Acesso</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="7" class="loading">Carregando estat√≠sticas...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Meu Hist√≥rico (Usu√°rio comum) -->
            <div id="myHistoryView" class="history-view">
                <!-- Estat√≠sticas do Usu√°rio -->
                <div id="myStatsCard" class="stats-card">
                    <h3>Minhas Estat√≠sticas</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="myTotalLogins">-</div>
                            <div class="stat-label">Total de Logins</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="myTotalAmbientes">-</div>
                            <div class="stat-label">Ambientes Gerados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="myFirstAccess">-</div>
                            <div class="stat-label">Primeiro Acesso</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="myLastAccess">-</div>
                            <div class="stat-label">√öltimo Acesso</div>
                        </div>
                    </div>
                </div>

                <!-- Abas de Hist√≥rico -->
                <div class="sub-tabs">
                    <button id="myLoginsTabBtn" class="sub-tab active">Logins</button>
                    <button id="myAmbientesTabBtn" class="sub-tab">Ambientes</button>
                </div>

                <!-- Lista de Logins -->
                <div id="myLoginsList" class="history-list active">
                    <p class="loading">Carregando logins...</p>
                </div>

                <!-- Lista de Ambientes -->
                <div id="myAmbientesList" class="history-list">
                    <p class="loading">Carregando ambientes...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Troca de Senha -->
    <div id="changePasswordScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromPasswordBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Trocar Senha</h1>
            </div>

            <form id="changePasswordForm" class="form-card">
                <div class="form-group">
                    <label for="senhaAtual">Senha Atual</label>
                    <input type="password" id="senhaAtual" name="senhaAtual" required>
                </div>

                <div class="form-group">
                    <label for="novaSenha">Nova Senha (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="novaSenha" name="novaSenha" required minlength="6">
                </div>

                <div class="form-group">
                    <label for="confirmarSenha">Confirmar Nova Senha</label>
                    <input type="password" id="confirmarSenha" name="confirmarSenha" required minlength="6">
                </div>

                <button type="submit" class="btn btn-primary">Alterar Senha</button>

                <div id="changePasswordMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de Gerenciamento de Usu√°rios (Apenas Admin) -->
    <div id="usersScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromUsersBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Gerenciar Usu√°rios</h1>
            </div>

            <button id="addUserBtn" class="btn btn-primary">+ Adicionar Usu√°rio</button>

            <!-- Campo de Busca -->
            <div class="search-box">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="searchUsersManagementInput" class="search-input" placeholder="Buscar por nome ou email...">
            </div>

            <!-- Bot√µes de Visualiza√ß√£o -->
            <div class="view-toggle-container">
                <button id="usersCardViewBtn" class="view-toggle-btn active">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                    </svg>
                    Cards
                </button>
                <button id="usersTableViewBtn" class="view-toggle-btn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                    Tabela
                </button>
            </div>

            <div id="usersList" class="users-list">
                <p class="loading">Carregando...</p>
            </div>

            <!-- Visualiza√ß√£o em Tabela -->
            <div id="usersTable" class="users-stats-table">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Data Cria√ß√£o</th>
                                <th>Data Expira√ß√£o</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usersManagementTableBody">
                            <tr>
                                <td colspan="6" class="loading">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Adicionar Usu√°rio (Apenas Admin) -->
    <div id="addUserScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromAddUserBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Adicionar Usu√°rio</h1>
            </div>

            <form id="addUserForm" class="form-card">
                <div class="info-box">
                    <p>A senha padr√£o ser√°: <strong>123456</strong></p>
                    <p>O usu√°rio poder√° alter√°-la ap√≥s o primeiro login.</p>
                </div>

                <div class="form-group">
                    <label for="newUsername">Nome de Usu√°rio</label>
                    <input type="text" id="newUsername" name="newUsername" required minlength="3" placeholder="Ex: joao">
                </div>

                <div class="form-group">
                    <label for="newNomeCompleto">Nome Completo</label>
                    <input type="text" id="newNomeCompleto" name="newNomeCompleto" required placeholder="Ex: Jo√£o Silva">
                </div>

                <button type="submit" class="btn btn-primary">Criar Usu√°rio</button>

                <div id="addUserMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de Solicita√ß√µes Pendentes (Apenas Admin) -->
    <div id="pendingUsersScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromPendingBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Solicita√ß√µes Pendentes</h1>
            </div>

            <div class="info-box">
                <p><strong>‚è≥ Usu√°rios Aguardando Aprova√ß√£o</strong></p>
                <p>Usu√°rios que confirmaram o email e aguardam sua aprova√ß√£o para ter acesso √† plataforma.</p>
            </div>

            <button id="approveAllPendingBtn" class="btn btn-success" style="margin-bottom: 20px;">
                ‚úÖ Ativar Todos Pendentes
            </button>

            <div id="pendingUsersList" class="users-list">
                <p class="loading">Carregando...</p>
            </div>
        </div>
    </div>

    <!-- Modal de Aprova√ß√£o -->
    <div id="approveModal" class="modal hidden">
        <div class="modal-content">
            <h2>Aprovar Usu√°rio</h2>
            <p id="approveUserName"></p>

            <div class="form-group">
                <label for="dataExpiracao">Data de Expira√ß√£o (opcional)</label>
                <input type="datetime-local" id="dataExpiracao" name="dataExpiracao">
                <small style="color: #6b7280; display: block; margin-top: 5px;">
                    Deixe em branco para acesso ilimitado
                </small>
            </div>

            <div class="modal-actions">
                <button id="confirmApproveBtn" class="btn btn-primary">‚úÖ Aprovar</button>
                <button id="cancelApproveBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Rejei√ß√£o -->
    <div id="rejectModal" class="modal hidden">
        <div class="modal-content">
            <h2>Rejeitar Usu√°rio</h2>
            <p id="rejectUserName"></p>

            <div class="form-group">
                <label for="motivoRejeicao">Motivo (opcional)</label>
                <textarea id="motivoRejeicao" name="motivoRejeicao" rows="3" placeholder="Ex: Dados incompletos, email inv√°lido..."></textarea>
            </div>

            <div class="modal-actions">
                <button id="confirmRejectBtn" class="btn btn-danger">‚ùå Rejeitar</button>
                <button id="cancelRejectBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Reativa√ß√£o -->
    <div id="reactivateModal" class="modal hidden">
        <div class="modal-content">
            <h2>Reativar Usu√°rio</h2>
            <p id="reactivateUserName"></p>

            <div class="form-group">
                <label for="dataExpiracaoReativar">Data de Expira√ß√£o (opcional)</label>
                <input type="datetime-local" id="dataExpiracaoReativar" name="dataExpiracaoReativar">
                <small style="color: #6b7280; display: block; margin-top: 5px;">
                    Deixe em branco para acesso ilimitado
                </small>
            </div>

            <div class="modal-actions">
                <button id="confirmReactivateBtn" class="btn btn-primary">‚úÖ Reativar</button>
                <button id="cancelReactivateBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Aprova√ß√£o em Lote -->
    <div id="approveAllModal" class="modal hidden">
        <div class="modal-content">
            <h2>Ativar Todos os Usu√°rios Pendentes</h2>
            <p id="approveAllCount" style="color: #6b7280; margin-bottom: 20px;"></p>

            <div class="form-group">
                <label for="dataExpiracaoLote">Data de Expira√ß√£o (opcional)</label>
                <input type="datetime-local" id="dataExpiracaoLote" name="dataExpiracaoLote">
                <small style="color: #6b7280; display: block; margin-top: 5px;">
                    Deixe em branco para acesso ilimitado. Esta data ser√° aplicada a TODOS os usu√°rios.
                </small>
            </div>

            <div class="modal-actions">
                <button id="confirmApproveAllBtn" class="btn btn-success">‚úÖ Ativar Todos</button>
                <button id="cancelApproveAllBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Usu√°rio -->
    <div id="editUserModal" class="modal hidden">
        <div class="modal-content">
            <h2>Editar Usu√°rio</h2>

            <div class="form-group">
                <label for="editUserNome">Nome Completo</label>
                <input type="text" id="editUserNome" name="editUserNome" required>
            </div>

            <div class="form-group">
                <label for="editUserEmail">Email</label>
                <input type="email" id="editUserEmail" name="editUserEmail" required>
            </div>

            <div class="form-group">
                <label for="editUserDataExpiracao">Data de Expira√ß√£o</label>
                <input type="datetime-local" id="editUserDataExpiracao" name="editUserDataExpiracao">
                <small style="color: #6b7280; display: block; margin-top: 5px;">
                    Deixe em branco para acesso ilimitado
                </small>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="editUserAtivo" name="editUserAtivo">
                    <span>Usu√°rio Ativo</span>
                </label>
            </div>

            <div class="modal-actions">
                <button id="confirmEditUserBtn" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                <button id="cancelEditUserBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Verifica√ß√£o de Email -->
    <div id="emailVerificationModal" class="modal hidden">
        <div class="modal-content email-verification-modal">
            <div class="modal-logo-container">
                <img src="images/logo.png" alt="PicStone Mobile" class="modal-logo">
            </div>
            <h2 class="modal-title">Bem-vindo ao PicStone Mobile!</h2>
            <p class="modal-message">Sua conta foi criada com sucesso.</p>
            <div class="modal-highlight">
                <svg class="modal-icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                </svg>
                <strong>Confirme seu email para come√ßar</strong>
            </div>
            <p class="modal-submessage">
                Enviamos um link de verifica√ß√£o para o seu email. Clique no link para ativar sua conta e come√ßar a usar o PicStone Mobile.
            </p>
            <button id="closeEmailModalBtn" class="btn btn-primary btn-full">Entendi</button>
        </div>
    </div>

    <!-- Loading Overlay Global -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="loading-message" id="loadingMessage">Gerando ambiente...</p>
            <p class="loading-submessage" id="loadingSubmessage">Isso pode levar alguns segundos</p>

            <!-- Barra de progresso (oculta por padr√£o) -->
            <div id="progressContainer" class="progress-container hidden">
                <div class="progress-bar">
                    <div id="progressBar" class="progress-fill"></div>
                </div>
                <p id="progressText" class="progress-text">0 de 0 mockups prontos</p>
            </div>
        </div>
    </div>

    <script src="app.js?v=20251119010000"></script>
    <script src="bookmatch.js?v=20251114144500"></script>
    <script src="history.js?v=20251111120000"></script>
</body>
</html>
