<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PicStone Mobile - Captura de Fotos</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="screen active">
        <div class="container">
            <div class="logo-container">
                <img src="images/logo.png" alt="PicStone Mobile" class="logo-image">
                <p class="app-description">Sistema de Captura de Fotos</p>
            </div>

            <form id="loginForm" class="form-card">
                <div class="form-group">
                    <label for="username">Usu√°rio</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>

                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>

                <button type="submit" class="btn btn-primary">Entrar</button>

                <div id="loginError" class="error-message hidden"></div>
            </form>

            <div class="info-text">
                <small>Usu√°rio padr√£o: admin / admin123</small>
            </div>
        </div>
    </div>

    <!-- Tela Principal - Menu Inicial -->
    <div id="mainScreen" class="screen">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <h1>PicStone Mobile</h1>
                </div>
                <div class="header-right">
                    <div class="user-menu">
                        <button id="userMenuBtn" class="user-menu-btn">
                            <div class="user-avatar">
                                <span id="userInitials"></span>
                            </div>
                            <span id="userDisplay" class="user-name"></span>
                            <svg class="chevron-down" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        <div id="userMenuDropdown" class="user-menu-dropdown hidden">
                            <div class="dropdown-header">
                                <div class="dropdown-user-info">
                                    <span class="dropdown-username" id="dropdownUsername"></span>
                                    <span class="dropdown-email" id="dropdownEmail"></span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button id="changePasswordBtn" class="dropdown-item">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                                Trocar Senha
                            </button>
                            <button id="manageUsersBtn" class="dropdown-item hidden">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                                Gerenciar Usu√°rios
                            </button>
                            <div class="dropdown-divider"></div>
                            <button id="logoutBtn" class="dropdown-item danger">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                Sair
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cards de Op√ß√µes Principais -->
            <div class="main-options">
                <div class="option-card" id="ambientesCard">
                    <div class="option-icon">
                        <img src="icon-ambientes.png" alt="Ambientes">
                    </div>
                    <h2>Ambientes</h2>
                    <button class="btn btn-primary">Acessar</button>
                </div>

                <div class="option-card" id="integracaoCard">
                    <div class="option-icon">üîó</div>
                    <h2>Integra√ß√£o</h2>
                    <button class="btn btn-primary">Acessar</button>
                </div>
            </div>

            <!-- Bot√£o de Hist√≥rico -->
            <button id="historyBtn" class="btn btn-secondary">üìã Ver Hist√≥rico</button>
        </div>
    </div>

    <!-- Tela de Integra√ß√£o -->
    <div id="integracaoScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainFromIntegracaoBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Integra√ß√£o</h1>
            </div>

            <!-- Preview da Foto -->
            <div id="photoPreviewIntegracao" class="photo-preview hidden">
                <img id="previewImageIntegracao" src="" alt="Preview">
                <button id="clearPhotoBtnIntegracao" class="btn-clear">‚úï</button>
                <button id="adjustImageBtnIntegracao" class="btn-crop-icon" title="Ajustar Imagem">‚úÇÔ∏è</button>
            </div>

            <!-- Bot√£o de Captura -->
            <div class="capture-section">
                <input type="file" id="fileInputIntegracao" accept="image/*" hidden>
                <button id="captureBtnIntegracao" class="btn btn-capture">
                    <span class="camera-icon">üì∑</span>
                    Escolher/Tirar Foto
                </button>
            </div>

            <!-- Formul√°rio de Dados -->
            <form id="uploadForm" class="form-card">
                <div class="form-group">
                    <label for="material">Material *</label>
                    <select id="material" name="material" required>
                        <option value="">Carregando materiais...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bloco">N√∫mero do Bloco *</label>
                    <input type="text" id="bloco" name="bloco" required placeholder="Ex: 12345 ou BL123" style="text-transform: uppercase;">
                </div>

                <div class="form-group">
                    <label for="chapa">N√∫mero da Chapa *</label>
                    <input type="text" id="chapa" name="chapa" required placeholder="Ex: 001">
                </div>

                <div class="form-group">
                    <label for="espessura">Espessura (cm)</label>
                    <select id="espessura" name="espessura">
                        <option value="">Selecione...</option>
                        <option value="2">2 cm</option>
                        <option value="3">3 cm</option>
                    </select>
                </div>

                <button type="submit" id="submitBtn" class="btn btn-primary" disabled>
                    Enviar Foto
                </button>

                <div id="uploadProgress" class="upload-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p class="progress-text">Enviando...</p>
                </div>

                <div id="uploadMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de Ambientes - Sele√ß√£o de Imagem -->
    <div id="ambientesScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainFromAmbientesBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Ambientes</h1>
            </div>

            <!-- Preview da Foto -->
            <div id="photoPreviewAmbientes" class="photo-preview hidden">
                <img id="previewImageAmbientes" src="" alt="Preview">
                <button id="clearPhotoBtnAmbientes" class="btn-clear">‚úï</button>
            </div>

            <!-- Bot√£o de Captura -->
            <div class="capture-section">
                <input type="file" id="fileInputAmbientes" accept="image/*" hidden>
                <button id="captureBtnAmbientes" class="btn btn-capture">
                    <span class="camera-icon">üì∑</span>
                    Escolher Imagem
                </button>
            </div>

            <!-- Bot√µes de Simula√ß√£o (aparecem ap√≥s escolher imagem) -->
            <div id="ambienteOptions" class="ambiente-options hidden">
                <h3>Escolha o tipo de ambiente:</h3>
                <button id="ambienteBtn" class="btn btn-ambiente">üìê Simular Cavalete</button>
                <button id="nichoBtn" class="btn btn-nicho hidden">üöø Simular Nicho</button>
                <button id="countertopsBtn" class="btn btn-countertops">ü™ë Simular Bancadas</button>
            </div>
        </div>
    </div>

    <!-- Tela de Crop -->
    <div id="cropScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelCropBtn" class="btn-icon">‚Üê Cancelar</button>
                <h1>Ajustar Imagem</h1>
            </div>

            <div class="crop-instructions">
                <p>Arraste para selecionar a √°rea de corte</p>
                <small>O corte ser√° aplicado automaticamente ao soltar</small>
            </div>

            <div class="crop-container">
                <canvas id="cropCanvas"></canvas>
            </div>

            <div id="cropInfo" class="crop-info hidden">
                <div class="crop-info-item">
                    <span class="crop-info-label">√Årea:</span>
                    <span id="cropInfoArea">-</span>
                </div>
                <div class="crop-info-item">
                    <span class="crop-info-label">Megapixels:</span>
                    <span id="cropInfoMP">-</span>
                </div>
                <div class="crop-info-item">
                    <span class="crop-info-label">Tamanho estimado:</span>
                    <span id="cropInfoSize">-</span>
                </div>
            </div>

            <div class="crop-actions">
                <button id="resetCropBtn" class="btn btn-secondary">Resetar Sele√ß√£o</button>
            </div>
        </div>
    </div>

    <!-- Tela de Configura√ß√£o de Ambiente -->
    <div id="ambienteConfigScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelAmbienteBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Simular Cavalete</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="form-group">
                    <label>Selecione o Fundo</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="fundoCavalete" value="claro" checked>
                            <span>‚òÄÔ∏è Claro</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fundoCavalete" value="escuro">
                            <span>üåô Escuro</span>
                        </label>
                    </div>
                </div>

                <button id="continuarCropAmbienteBtn" class="btn btn-primary">Continuar para Crop</button>
            </div>
        </div>
    </div>

    <!-- Tela de Configura√ß√£o do Nicho -->
    <div id="nichoConfigScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelNichoBtn" class="btn-icon">‚Üê Cancelar</button>
                <h1>Configurar Nicho</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="info-box">
                    <p><strong>üöø Ambiente de Nicho de Banheiro</strong></p>
                    <p>Crie visualiza√ß√µes realistas de nichos com sua pedra natural.</p>
                    <p>Ser√£o geradas 2 vers√µes (normal e rotacionada 180¬∞).</p>
                </div>

                <div class="config-section">
                    <h3>Fundo do Ambiente</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="fundoNicho" value="claro" checked>
                            <span>‚òÄÔ∏è Claro (Branco)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="fundoNicho" value="escuro">
                            <span>üåô Escuro (Cinza)</span>
                        </label>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Objetos Decorativos</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="incluirShampoo" name="incluirShampoo">
                            <span>üß¥ Incluir Frasco de Shampoo</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="incluirSabonete" name="incluirSabonete">
                            <span>üßº Incluir Sabonete</span>
                        </label>
                    </div>
                </div>

                <button id="continuarCropNichoBtn" class="btn btn-primary">Continuar para Crop</button>
            </div>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Bancada -->
    <div id="countertopSelectionScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="cancelCountertopSelectionBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Escolha o Tipo de Bancada</h1>
            </div>

            <div class="ambiente-config-card">
                <div class="config-section">
                    <h3>Escolha o Design</h3>
                    <div class="countertop-options">
                        <div class="countertop-card" data-type="bancada1">
                            <div class="countertop-preview" data-type="bancada1">
                                <img src="/images/thumb-bancada1.png" alt="Preview Bancada #1">
                            </div>
                            <h4>Bancada #1</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada2">
                            <div class="countertop-preview" data-type="bancada2">
                                <img src="/images/thumb-bancada2.png" alt="Preview Bancada #2">
                            </div>
                            <h4>Bancada #2</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada3">
                            <div class="countertop-preview" data-type="bancada3">
                                <img src="/images/thumb-bancada3.png" alt="Preview Bancada #3">
                            </div>
                            <h4>Bancada #3</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada4">
                            <div class="countertop-preview" data-type="bancada4">
                                <img src="/images/thumb-bancada4.png" alt="Preview Bancada #4">
                            </div>
                            <h4>Bancada #4</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada5">
                            <div class="countertop-preview" data-type="bancada5">
                                <img src="/images/thumb-bancada5.png" alt="Preview Bancada #5">
                            </div>
                            <h4>Bancada #5</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada6">
                            <div class="countertop-preview" data-type="bancada6">
                                <img src="/images/thumb-bancada6.png" alt="Preview Bancada #6">
                            </div>
                            <h4>Bancada #6</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada7">
                            <div class="countertop-preview" data-type="bancada7">
                                <img src="/images/thumb-bancada7.png" alt="Preview Bancada #7">
                            </div>
                            <h4>Bancada #7</h4>
                        </div>

                        <div class="countertop-card" data-type="bancada8">
                            <div class="countertop-preview" data-type="bancada8">
                                <img src="/images/thumb-bancada8.png" alt="Preview Bancada #8">
                            </div>
                            <h4>Bancada #8</h4>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>Op√ß√µes Globais</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="flipCountertop" name="flipCountertop">
                            <span>‚ÜîÔ∏è Inverter Horizontalmente (Flip)</span>
                        </label>
                    </div>
                    <small style="color: #6b7280; display: block; margin-top: 8px;">
                        Ser√£o geradas 2 vers√µes (normal e rotacionada 180¬∞)
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Resultado do Ambiente -->
    <div id="ambienteResultScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backToMainBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Ambientes Gerados</h1>
            </div>

            <div id="ambientesGallery" class="ambientes-gallery">
                <!-- Os ambientes ser√£o inseridos aqui dinamicamente -->
            </div>

            <div class="ambiente-actions">
                <button id="downloadAllAmbientesBtn" class="btn btn-primary">‚¨áÔ∏è Baixar Todos</button>
                <button id="newAmbienteBtn" class="btn btn-secondary">üîÑ Gerar Novos</button>
            </div>

            <div id="ambienteMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- Tela de Hist√≥rico -->
    <div id="historyScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Hist√≥rico de Fotos</h1>
            </div>

            <div id="historyList" class="history-list">
                <p class="loading">Carregando...</p>
            </div>
        </div>
    </div>

    <!-- Tela de Troca de Senha -->
    <div id="changePasswordScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromPasswordBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Trocar Senha</h1>
            </div>

            <form id="changePasswordForm" class="form-card">
                <div class="form-group">
                    <label for="senhaAtual">Senha Atual</label>
                    <input type="password" id="senhaAtual" name="senhaAtual" required>
                </div>

                <div class="form-group">
                    <label for="novaSenha">Nova Senha (m√≠nimo 6 caracteres)</label>
                    <input type="password" id="novaSenha" name="novaSenha" required minlength="6">
                </div>

                <div class="form-group">
                    <label for="confirmarSenha">Confirmar Nova Senha</label>
                    <input type="password" id="confirmarSenha" name="confirmarSenha" required minlength="6">
                </div>

                <button type="submit" class="btn btn-primary">Alterar Senha</button>

                <div id="changePasswordMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Tela de Gerenciamento de Usu√°rios (Apenas Admin) -->
    <div id="usersScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromUsersBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Gerenciar Usu√°rios</h1>
            </div>

            <button id="addUserBtn" class="btn btn-primary">+ Adicionar Usu√°rio</button>

            <div id="usersList" class="users-list">
                <p class="loading">Carregando...</p>
            </div>
        </div>
    </div>

    <!-- Tela de Adicionar Usu√°rio (Apenas Admin) -->
    <div id="addUserScreen" class="screen">
        <div class="container">
            <div class="header">
                <button id="backFromAddUserBtn" class="btn-icon">‚Üê Voltar</button>
                <h1>Adicionar Usu√°rio</h1>
            </div>

            <form id="addUserForm" class="form-card">
                <div class="info-box">
                    <p>A senha padr√£o ser√°: <strong>123456</strong></p>
                    <p>O usu√°rio poder√° alter√°-la ap√≥s o primeiro login.</p>
                </div>

                <div class="form-group">
                    <label for="newUsername">Nome de Usu√°rio</label>
                    <input type="text" id="newUsername" name="newUsername" required minlength="3" placeholder="Ex: joao">
                </div>

                <div class="form-group">
                    <label for="newNomeCompleto">Nome Completo</label>
                    <input type="text" id="newNomeCompleto" name="newNomeCompleto" required placeholder="Ex: Jo√£o Silva">
                </div>

                <button type="submit" class="btn btn-primary">Criar Usu√°rio</button>

                <div id="addUserMessage" class="message hidden"></div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay Global -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="loading-message">Gerando ambiente...</p>
            <p class="loading-submessage">Isso pode levar alguns segundos</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
